{
  "page_id": "portfolio_dashboard_v2",
  "title": "Dashboard Portefeuille Avanc√©",
  "description": "Dashboard interactif avec actions configurables",
  "layout": "vertical",
  "refresh_interval": 300,
  "metadata": {
    "author": "Analytics Team",
    "version": "2.0",
    "created": "2024-01-15",
    "data_source": "PostgreSQL"
  },
  "global_actions": {
    "refresh": {
      "enabled": true,
      "interval": 300,
      "label": "üîÑ Rafra√Æchir tout",
      "endpoint": "/api/refresh-all"
    },
    "export": {
      "enabled": true,
      "formats": ["pdf", "html"],
      "label": "üì• Exporter la page"
    },
    "screenshot": {
      "enabled": true,
      "label": "üì∏ Capture d'√©cran"
    }
  },
  "sections": [
    {
      "title": "Vue d'Ensemble",
      "layout": "2-columns",
      "components": [
        {
          "type": "table",
          "title": "Top 10 Portefeuilles",
          "style": {
            "height": "400px",
            "borderColor": "#007348"
          },
          "data": {
            "type": "sql",
            "query": """
              SELECT 
                p.id,
                p.nom as "Portefeuille",
                c.nom as "Client",
                p.valeur_total as "Valeur (‚Ç¨)",
                p.performance as "Performance (%)",
                p.risque as "Niveau de Risque",
                p.date_maj as "Derni√®re MAJ"
              FROM portefeuilles p
              JOIN clients c ON p.client_id = c.id
              WHERE p.actif = TRUE
              ORDER BY p.valeur_total DESC
              LIMIT 10
            """,
            "params": {}
          },
          "config": {
            "columns": ["Portefeuille", "Client", "Valeur (‚Ç¨)", "Performance (%)", "Niveau de Risque"],
            "transform": [
              {
                "type": "sort",
                "columns": ["Valeur (‚Ç¨)"],
                "ascending": false
              }
            ]
          },
          "actions": {
            "refresh": {
              "enabled": true,
              "interval": 60,
              "label": "üîÑ",
              "tooltip": "Rafra√Æchir les donn√©es"
            },
            "export": {
              "enabled": true,
              "formats": ["csv", "excel", "json"],
              "label": "üì•",
              "tooltip": "Exporter les donn√©es"
            },
            "filter": {
              "enabled": true,
              "options": [
                {"label": "Tous", "value": "all"},
                {"label": "Risque √âlev√©", "value": "high"},
                {"label": "Risque Moyen", "value": "medium"},
                {"label": "Risque Faible", "value": "low"}
              ],
              "label": "üîç",
              "tooltip": "Filtrer par risque"
            }
          }
        },
        {
          "type": "chart",
          "title": "Distribution par Type d'Investissement",
          "chart_type": "pie",
          "style": {
            "height": "400px"
          },
          "data": {
            "type": "sql",
            "query": """
              SELECT 
                i.type as "Type",
                SUM(p.valeur_total) as "Valeur Totale"
              FROM portefeuilles p
              JOIN investissements i ON p.investissement_id = i.id
              GROUP BY i.type
              ORDER BY "Valeur Totale" DESC
            """
          },
          "chart_config": {
            "labels_column": "Type",
            "values_column": "Valeur Totale",
            "layout": {
              "title": "R√©partition des Investissements",
              "showlegend": true
            }
          },
          "actions": {
            "refresh": {
              "enabled": true,
              "interval": 120,
              "label": "üîÑ"
            },
            "export": {
              "enabled": true,
              "formats": ["png", "svg", "pdf"],
              "label": "üíæ",
              "tooltip": "T√©l√©charger l'image"
            },
            "toggle": {
              "enabled": true,
              "options": ["pie", "bar", "donut"],
              "label": "üìä",
              "tooltip": "Changer le type de graphique"
            }
          }
        }
      ]
    },
    {
      "title": "Analyses Avanc√©es",
      "layout": "full",
      "components": [
        {
          "type": "chart",
          "title": "√âvolution des Performances",
          "chart_type": "line",
          "data": {
            "type": "sql",
            "query": """
              SELECT 
                date_trunc('month', ph.date) as "Mois",
                AVG(ph.performance) as "Performance Moyenne",
                MIN(ph.performance) as "Performance Min",
                MAX(ph.performance) as "Performance Max"
              FROM portefeuille_historique ph
              WHERE ph.date >= NOW() - INTERVAL '1 year'
              GROUP BY date_trunc('month', ph.date)
              ORDER BY "Mois"
            """
          },
          "chart_config": {
            "x_column": "Mois",
            "y_column": "Performance Moyenne",
            "layout": {
              "title": "Performance Mensuelle Moyenne",
              "xaxis_title": "Mois",
              "yaxis_title": "Performance (%)",
              "showlegend": true
            }
          },
          "actions": {
            "refresh": {
              "enabled": true,
              "label": "Actualiser"
            },
            "screenshot": {
              "enabled": true,
              "label": "üì∏",
              "tooltip": "Capture du graphique"
            },
            "zoom": {
              "enabled": true,
              "label": "üîç",
              "tooltip": "Mode zoom"
            }
          }
        },
        {
          "type": "custom",
          "title": "Calculateur de ROI",
          "component": "roi_calculator",
          "data": {
            "type": "function",
            "function": "calculate_roi_parameters",
            "params": {
              "currency": "EUR",
              "period": "annual"
            }
          },
          "actions": {
            "calculate": {
              "enabled": true,
              "label": "üßÆ Calculer",
              "endpoint": "/api/calculate-roi"
            },
            "save": {
              "enabled": true,
              "label": "üíæ Sauvegarder"
            },
            "share": {
              "enabled": true,
              "label": "üì§ Partager"
            }
          }
        }
      ]
    },
    {
      "title": "Alertes et Notifications",
      "layout": "grid",
      "components": [
        {
          "type": "metric",
          "title": "Portefeuilles √† Surveiller",
          "data": {
            "type": "sql",
            "query": """
              SELECT COUNT(*) as count
              FROM portefeuilles
              WHERE performance < -5 
                AND date_maj >= NOW() - INTERVAL '7 days'
            """
          },
          "config": {
            "format": "number",
            "color": "#ff4444",
            "icon": "‚ö†Ô∏è"
          },
          "actions": {
            "notify": {
              "enabled": true,
              "label": "üîî Notifier",
              "channel": ["email", "slack"]
            },
            "details": {
              "enabled": true,
              "label": "üìã D√©tails",
              "modal": "alert_details"
            }
          }
        }
      ]
    }
  ]
}